---
import SectionHeading from "../ui/SectionHeading.astro";
import DecorShapes from "../ui/DecorShapes.astro";
import faqData from "../../../content/data/faq.json";
---

<section id="faq" class="relative overflow-hidden rounded-2xl bg-cream px-8 py-16 md:px-32" data-sb-object-id="content/data/faq.json">
  <DecorShapes section="faq" />
  <div class="relative flex flex-col items-center gap-10">
    <SectionHeading>{faqData.heading}</SectionHeading>

    <div class="w-full">
      {faqData.faqs.map((faq: { question: string; answer: string }, i: number) => (
        <div
          class="faq-item border-t border-taupe"
          data-faq-index={i}
          data-sb-field-path={`faqs.${i}`}
        >
          <button
            class="flex w-full items-center justify-between py-5 text-left transition-colors duration-200"
            aria-expanded="false"
          >
            <span class="text-base text-dark font-body pr-4" data-sb-field-path=".question">{faq.question}</span>
            <svg
              class="faq-icon h-[18px] w-[18px] shrink-0 text-muted transition-transform duration-300"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path stroke-linecap="round" d="M12 5v14M5 12h14" />
            </svg>
          </button>
          <div class="faq-answer grid grid-rows-[0fr] transition-[grid-template-rows] duration-300 ease-out">
            <div class="overflow-hidden">
              <p class="pb-5 text-sm leading-relaxed text-charcoal font-body" data-sb-field-path=".answer">
                {faq.answer}
              </p>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  document.querySelectorAll(".faq-item").forEach((item) => {
    const btn = item.querySelector("button");
    const answer = item.querySelector(".faq-answer");
    const icon = item.querySelector(".faq-icon");

    btn?.addEventListener("click", () => {
      const isOpen = btn.getAttribute("aria-expanded") === "true";

      // Close all others
      document.querySelectorAll(".faq-item").forEach((other) => {
        other.querySelector("button")?.setAttribute("aria-expanded", "false");
        other.querySelector(".faq-answer")?.classList.remove("grid-rows-[1fr]");
        other.querySelector(".faq-answer")?.classList.add("grid-rows-[0fr]");
        other.querySelector(".faq-icon")?.classList.remove("rotate-45");
      });

      // Toggle current
      if (!isOpen) {
        btn.setAttribute("aria-expanded", "true");
        answer?.classList.remove("grid-rows-[0fr]");
        answer?.classList.add("grid-rows-[1fr]");
        icon?.classList.add("rotate-45");
      }
    });
  });
</script>
